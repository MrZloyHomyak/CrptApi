# CrptApi - Thread-safe –∫–ª–∏–µ–Ω—Ç –¥–ª—è API –ß–µ—Å—Ç–Ω–æ–≥–æ –∑–Ω–∞–∫–∞
Java –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API —Å–∏—Å—Ç–µ–º—ã –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ "–ß–µ—Å—Ç–Ω—ã–π –∑–Ω–∞–∫". –†–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤.

## üöÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- **Thread-safe implementation** - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ
- **Rate limiting** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (Sliding Window algorithm)
- **Modern Java** - HttpClient, Instant, CompletableFuture
- **Zero dependencies** - —Ç–æ–ª—å–∫–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ Java 11+
- **RESTful API client** - –ø–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ API

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Java 11 –∏–ª–∏ –≤—ã—à–µ
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- –î–æ—Å—Ç—É–ø –∫ API –ß–µ—Å—Ç–Ω–æ–≥–æ –∑–Ω–∞–∫–∞
- –í—Å–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–ª–∞—Å—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- `CrptApi` - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–æ–≤
- `Document` - –º–æ–¥–µ–ª—å –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–ª—è –≤–≤–æ–¥–∞ –≤ –æ–±–æ—Ä–æ—Ç
- `Product` - –º–æ–¥–µ–ª—å —Ç–æ–≤–∞—Ä–∞
- `Description` - –æ–ø–∏—Å–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞

### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **Facade** - –ø—Ä–æ—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–ª–æ–∂–Ω–æ–≥–æ API
- **Builder** - –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- **Immutable objects** - –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
### –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
```java
// 5 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
CrptApi api = new CrptApi(TimeUnit.SECONDS, 5);

// –° —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–æ–≤–∞—Ä–Ω–æ–π –≥—Ä—É–ø–ø—ã
CrptApi api = new CrptApi(TimeUnit.SECONDS, 5, "milk");

// –° –∫–∞—Å—Ç–æ–º–Ω—ã–º URL API
CrptApi api = new CrptApi(TimeUnit.SECONDS, 5, "https://api.example.com", "shoes");
```
### –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
```java
// –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
Document document = new Document();
document.setDoc_id("DOC-123");
document.setDoc_status("IN_PROGRESS");

Description description = new Description();
description.setParticipantInn("1234567890");
document.setDescription(description);

// –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
Product product = new Product();
product.setTnved_code("6401100000");
product.setUit_code("010463003407002921xxx");
document.setProducts(new Product[]{product});

// –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
String signature = "base64_signature";
api.createDocument(document, signature);
```
## ‚ö° –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:

- `ReentrantLock` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- `ConcurrentLinkedQueue` –¥–ª—è thread-safe –æ—á–µ—Ä–µ–¥–∏
- `Instant` –¥–ª—è —Ç–æ—á–Ω—ã—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫
- `Sliding Window` –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
```java
// –†–∞–∑–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
CrptApi strictApi = new CrptApi(TimeUnit.SECONDS, 1);    // 1 –∑–∞–ø—Ä–æ—Å/—Å–µ–∫—É–Ω–¥—É
CrptApi normalApi = new CrptApi(TimeUnit.SECONDS, 10);   // 10 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫—É–Ω–¥—É  
CrptApi bulkApi = new CrptApi(TimeUnit.MINUTES, 1000);   // 1000 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É
```
## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
### –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞
```java
@Test
void testRateLimiting() throws InterruptedException {
CrptApi api = new CrptApi(TimeUnit.SECONDS, 2);

    long startTime = System.currentTimeMillis();
    
    // 4 –∑–∞–ø—Ä–æ—Å–∞ –ø—Ä–∏ –ª–∏–º–∏—Ç–µ 2/—Å–µ–∫—É–Ω–¥—É
    for (int i = 0; i < 4; i++) {
        api.createDocument(testDocument, "signature");
    }
    
    long duration = System.currentTimeMillis() - startTime;
    assertTrue(duration >= 2000); // –î–æ–ª–∂–Ω–æ –∑–∞–Ω—è—Ç—å ~2 —Å–µ–∫—É–Ω–¥—ã
}
```
## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞: < 1ms
- –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏: –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

## üìö –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ API
#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ API –ß–µ—Å—Ç–Ω–æ–≥–æ –∑–Ω–∞–∫–∞:
- –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ JSON
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Bearer token
- –ö–æ–¥—ã —Ç–æ–≤–∞—Ä–Ω—ã—Ö –≥—Ä—É–ø–ø (clothes, milk, shoes –∏ –ø—Ä–æ—á–∏–µ)
- –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

## üîÆ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
#### –ö–æ–¥ –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏:
- –î—Ä—É–≥–∏—Ö –º–µ—Ç–æ–¥–æ–≤ API (–æ—Ç–≥—Ä—É–∑–∫–∞, –∞–≥—Ä–µ–≥–∞—Ü–∏—è, etc.)
- –ö–∞—Å—Ç–æ–º–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –æ—à–∏–±–æ–∫
- –ú–µ—Ç—Ä–∏–∫ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- Retry –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤

## ü§ù –ö–æ–Ω—Ç–∞–∫—Ç—ã
–ì–∞–≤—Ä–∏–ª–∏–Ω –î–º–∏—Ç—Ä–∏–π - ddd.gavrilin@gmail.com - https://github.com/MrZloyHomyak